const { chromium } = require('playwright');
const path = require('path');
const fs = require('fs');

async function captureScreenshots() {
  // Create screenshots directory
  const screenshotsDir = path.join(__dirname, 'docs', 'images');
  if (!fs.existsSync(screenshotsDir)) {
    fs.mkdirSync(screenshotsDir, { recursive: true });
  }

  const browser = await chromium.launch({ headless: true });
  const context = await browser.newContext({
    viewport: { width: 1920, height: 1080 },
    deviceScaleFactor: 1
  });
  
  const page = await context.newPage();

  try {
    console.log('üöÄ Starting ProjectHub v2.0.0 screenshot capture...');

    // 1. Login page
    console.log('üì∏ Capturing login page...');
    await page.goto('http://localhost:8090/', { waitUntil: 'networkidle' });
    await page.waitForTimeout(2000);
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'login-page.png'),
      fullPage: false
    });

    // 2. Login with demo credentials
    console.log('üì∏ Logging in...');
    await page.fill('input[placeholder="Email address"]', 'admin@projecthub.local');
    await page.fill('input[placeholder="Password"]', 'admin123');
    await page.click('button[type="submit"]');
    await page.waitForTimeout(3000);

    // 3. Dashboard
    console.log('üì∏ Capturing dashboard...');
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'dashboard.png'),
      fullPage: false
    });

    // 4. Projects page
    console.log('üì∏ Capturing projects page...');
    await page.click('text=Projects');
    await page.waitForTimeout(2000);
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'projects-page.png'),
      fullPage: false
    });

    // 5. Create project modal
    console.log('üì∏ Capturing create project modal...');
    await page.click('text=Create Project');
    await page.waitForTimeout(1000);
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'create-project-modal.png'),
      fullPage: false
    });
    await page.click('.modal-backdrop');
    await page.waitForTimeout(500);

    // 6. Kanban board
    console.log('üì∏ Capturing kanban board...');
    await page.click('text=Board');
    await page.waitForTimeout(2000);
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'kanban-board.png'),
      fullPage: false
    });

    // 7. Analytics
    console.log('üì∏ Capturing analytics dashboard...');
    await page.click('text=Analytics');
    await page.waitForTimeout(4000); // Wait for charts to load
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'analytics-dashboard.png'),
      fullPage: false
    });

    // 8. Webhooks
    console.log('üì∏ Capturing webhooks management...');
    await page.click('text=Webhooks');
    await page.waitForTimeout(2000);
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'webhooks-management.png'),
      fullPage: false
    });

    // 9. Dark mode
    console.log('üì∏ Capturing dark mode...');
    await page.click('button[aria-label="Toggle theme"]');
    await page.waitForTimeout(1000);
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'dashboard-dark.png'),
      fullPage: false
    });

    // 10. Mobile view
    console.log('üì∏ Capturing mobile view...');
    await page.setViewportSize({ width: 375, height: 812 }); // iPhone X size
    await page.click('text=Projects');
    await page.waitForTimeout(2000);
    await page.screenshot({ 
      path: path.join(screenshotsDir, 'mobile-projects.png'),
      fullPage: false
    });

    console.log('‚úÖ Screenshot capture completed!');
    console.log(`üìÅ Screenshots saved to: ${screenshotsDir}`);

  } catch (error) {
    console.error('‚ùå Error during screenshot capture:', error);
  } finally {
    await browser.close();
  }
}

// Run the screenshot capture
captureScreenshots().catch(console.error);