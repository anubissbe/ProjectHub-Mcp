name: 🚀 CI/CD Pipeline (Legacy - Being Phased Out)

on:
  workflow_dispatch:  # Manual trigger only to clear stale config

permissions:
  contents: read
  security-events: write
  actions: read

jobs:
  # Minimal docker-security job to clear stale configuration
  docker-security:
    name: 🐳 Docker & Security (Legacy)
    runs-on: ubuntu-latest
    
    steps:
    - name: 📦 Checkout code
      uses: actions/checkout@v4
      
    - name: ⚠️ Legacy Configuration Notice
      run: |
        echo "This is a legacy configuration being phased out"
        echo "All security scanning has moved to main.yml workflow"
        echo "This job exists only to clear stale GitHub configurations"
        
    - name: 🔍 Final Trivy scan (for config cleanup)
      uses: aquasecurity/trivy-action@master
      continue-on-error: true
      with:
        scan-type: 'fs'
        scan-ref: '.'
        format: 'sarif'
        output: 'trivy-results-legacy.sarif'
        exit-code: '0'
        severity: 'CRITICAL,HIGH'
        
    - name: 📤 Upload legacy results
      uses: github/codeql-action/upload-sarif@v3
      if: always() && hashFiles('trivy-results-legacy.sarif') != ''
      continue-on-error: true
      with:
        sarif_file: 'trivy-results-legacy.sarif'
        category: 'docker-security'